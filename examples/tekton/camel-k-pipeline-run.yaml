---
apiVersion: tekton.dev/v1alpha1
kind: PipelineResource
metadata:
  name: camel-k-examples-git
spec:
  type: git
  params:
    - name: revision
      value: tekton
    - name: url
      value: https://github.com/nicolaferraro/camel-k
---
apiVersion: tekton.dev/v1alpha1
kind: Task
metadata:
  name: camel-k-install-operator
spec:
  steps:
    - name: install
      image: nferraro/camel-k:1.0.0-M2-SNAPSHOT
      command:
        - kamel
      args:
        - "install"
        - "--skip-cluster-setup"
        - "--operator-image"
        - "nferraro/camel-k:1.0.0-M2-SNAPSHOT"
---
apiVersion: tekton.dev/v1alpha1
kind: Pipeline
metadata:
  name: camel-k-pipeline
spec:
  resources:
    - name: source-repo
      type: git
  tasks:
    - name: install-operator
      taskRef:
        name: camel-k-install-operator
---
apiVersion: tekton.dev/v1alpha1
kind: PipelineRun
metadata:
  name: camel-k-pipeline-run-1
spec:
  pipelineRef:
    name: camel-k-pipeline
  serviceAccount: 'default'
  resources:
    - name: source-repo
      resourceRef:
        name: camel-k-examples-git
